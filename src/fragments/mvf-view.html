<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/app-storage/app-localstore/app-localstore-document.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../shared-styles.html">


<dom-module id="mvf-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      paper-material{
        min-width: 300px;
      }

    </style>
    <iron-ajax
      id="ajax"
      url="/getMailVerification"
      handle-as="json"
      method="POST"
      on-response="handleResponse">
    </iron-ajax>
    <app-localstorage-document id="localStorageLang" key="langauge" data="{{language}}"></app-localstorage-document>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>
    <div class="layout vertical">
      <paper-material elevation="3" hero class="container">
        <iron-pages selected="[[page]]" attr-for-selected="name">
          <section name="success">
            <div class="vertical layout">
              <h2>Has confirmado tu correo exitosamente</h2>
              <span>Puedes regresar a tu cuenta haciendo click <a href="/acco">Aquí</a> </span>
            </div>
          </section>
          <section name="failure">
            <div class="vertical layout">
              <h2>El tiempo para verificar tu correo ha expirado</h2>
              <span>Puedes solicitar otro correo de verificación a continuación</span>
              <paper-button raised class="secondary" on-click="send">Solicitar verificación</paper-button>
            </div>
          </section>
        </iron-pages>
      </paper-material>
    </div>
    <paper-toast id="toast" duration="0">
      <paper-button calss="secondary" on-click="closeToast">Cerrar</paper-button>
    </paper-toast>

  </template>
  <script>
    Polymer({
      is: 'mvf-view',

      properties:{
        page:{
          type:String,
          reflectToAttribute: true
        },
        language :{
          tpye : String,
          value : 'es'
        },
        resources:{
          value:function(){
            return {
              "es":{
                "success":"Se ha enviado un correo a {address} con un link para la verificación",
                "failure":"Ya se ha enviado un correo de verificación o ya has confirmado tu correo"
              },
              "en":{
                "success":"An email with a verification link has been sent to {address}",
                "failure":"An email has already been sent or that address is already verified"
              }
            };
          }
        }
      },
      behaviors : [
        Polymer.AppLocalizeBehavior
      ],
      observers: [
        '_routePageChanged(routeData.page)'
      ],

      _routePageChanged: function(page) {
        this.page = page || 'succes';
      },
      send:function(){
        this.$.ajax.generateRequest();
      },
      handleResponse:function(e){
        var response = e.detail.__data__.response;
        if(response.success){
          this.$.toast.text=this.localize('success','address',response.address);
        }else{
          this.$.toast.text=this.localize('failure');
        }
        this.$.toast.show();
      },
      closeToast:function(){
        this.$.toast.close();
      }

    });
  </script>
</dom-module>
