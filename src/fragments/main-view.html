<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-box/app-box.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="../../bower_components/re-captcha/re-captcha.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../elements/lang-selector.html">
<link rel="import" href="../shared-styles.html">
<dom-module id="main-view">
  <template>
    <style include="app-grid-style shared-styles">
      .secondary-text{
          color:var(--secondary-text-color);
      }
      .first{
        height: 600px;
      }
      app-drawer{
        --app-drawer-content-container:{
          background-color: var(--default-primary-color);
        };
      }
    </style>
    <iron-ajax
    url="/getcurrentuser"
    handle-as="json"
    on-response="currentUserHandler"
    id="currentUserRequester"
    on-error="currentUserErrorHandler"></iron-ajax>
    <app-localstorage-document key="langauge" data="{{language}}"></app-localstorage-document>
    <app-drawer-layout fullbleed force-narrow>
      <app-drawer align="right">
         <div role="listbox">
           <paper-item><a href="/help">Ayuda</a></paper-item>
           <paper-item><a href="/rgst">Registrarme</a></paper-item>
           <paper-item id="accoPaperitem"><a href="/acco">[[user.firstName]]</a></paper-item>
           <paper-item id="loginPaperitem"><a href="/lgin">Ingresar</a></paper-item>
         </div>
      </app-drawer>
      <app-header-layout>
       <app-header>
         <app-toolbar>
             <div main-title><span class="text-display-2">Vazitoazul</span></div>
             <div class="hidden-sm-down">
               <a href="/help"><paper-button>Ayuda</paper-button></a>
               <a href="/rgst"><paper-button>Registrarme</paper-button></a>
               <a href="/lgin" hidden id="loginButton"><paper-button raised class="primary">Ingresar</paper-button></a>
               <a href="/acco" hidden id="accoButton"><paper-button raised class="primary">[[user.firstName]]</paper-button></a>
             </div>
             <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
         </app-toolbar>
       </app-header>
       <div>
         <section>
           <div class="container center vertical">
             <div class="row">
               <h2 class="text-xs-center">Descubre un mundo de oportunidades</h1>
               <h4 class="text-xs-center">Encuentra a las personas que necesitas para salir adelante.</h2>
               <div class="w-100 horizontal center">
                 <a href="/rgst"><paper-button raised class="secondary">Regsitrarme</paper-button></a>
                 <a href="/tut"><paper-button raised class="info">¿Cómo funciona?</paper-button></a>
               </div>
             </div>

            <br>
            <br>
           </div>
         </section>
         <section>
           <app-box class="first " effects="parallax-background">
             <div class="container h-100">
               <div class="h-100 vertical center">
                <h3 class="secondary-text">Invierte en nuestros planes para tener un redito inmediato.</h3>
               </div>
             </div>
             <img background src="//app-layout-assets.appspot.com/assets/bg2.jpg" style="width:100%; height: 900px" />
           </app-box>
         </section>
       </div>

     </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    Polymer({
      is: 'main-view',

      behaviors : [
        Polymer.AppLocalizeBehavior
      ],

      properties : {
        language : {
          value : 'en'
        },
        user :{
          type : Object
        }
      },

      ready : function(){
       this.$.currentUserRequester.generateRequest();
      },

      currentUserHandler : function(e){
        console.log(e);
        var user = e.detail.__data__.response;
        if(user){
          this.set('user',user);
          this.$.accoButton.hidden = false;
          this.$.accoPaperitem.hidden = false;
        }else{
          this.$.loginButton.hidden = false;
          this.$.loginPaperitem.hidden = false;
        }
      },

      attached : function() {
        this.loadResources( this.resolveUrl('../locales/main-view.json'));
      },

      currentUserErrorHandler : function(e){
        this.$.loginButton.hidden = false;
      },
    });
  </script>
</dom-module>
