<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../my-icons.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../elements/facebook-login.html">
<link rel="import" href="../elements/google-login.html">

<dom-module id="lgin-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        height: 100vh;
        padding: 10px 20px;
        @apply(--layout-vertical);
        @apply(--layout-center-center);
      }
      paper-card {
        width: 320px;
      }
      .divider{
        border-style: solid;
        border-color: #bdced7;
        border-width: 0 0 1px 0;
      }
    </style>
  <app-localstorage-document key="language" data="{{language}}"></app-localstorage-document>
  <h2>[[localize('log_in_tittle')]]</h2>
  <paper-card>
    <div class="card-content">
      <div class="row flex-items-xs-center">
        <facebook-login recommender="[[recommender]]" on-user-logged="handleThirdPartyLogin" on-show-message="showMessage"></facebook-login>
        <google-login recommender="[[recommender]]" on-user-logged="handleThirdPartyLogin" on-show-message="showMessage"></google-login>
      </div>
      <form is="iron-form" method="POST" action="/auth/local" on-iron-form-response= "responseHandler" id="registerForm">
      	  <paper-input name="identifier" label="[[localize('email')]]" required auto-validate  error-message="[[localize('email_form')]]"></paper-input>
          <paper-input name="password" id="password" label="[[localize('password')]]" type="password" required auto-validate ></paper-input>
    	</form>
      <br>
      <div class="flex-items-xs-center row">
        <paper-button raised class="secondary" on-click="submit" id="submitButton">
        <paper-spinner id="spinner" hidden></paper-spinner>[[localize('log_in')]]</paper-button>
      </div>
    </div>
  </paper-card>
  <div class="output"></div>
	<paper-toast id="toast" duration="5000" ></paper-toast>
  </template>

  <script>
    Polymer({
      is: 'lgin-view',

      behaviors : [
        Polymer.AppLocalizeBehavior
      ],

      properties : {

        language : {
          value : 'en'
        },
        resources: {
                value: function() {
                  return {
                    'en': {
                      'log_in_tittle' : 'Log In',
                      'email' : 'Email',
                      'password' : 'Password' ,
                      'log_in' : 'Log in',
                      'email_form' : 'Must be a valid email',
                      'repeat_pass' : 'Repeat your password',
                      'email_or_pass_wrong' : 'Email or password incorrect.'
                    },
                    'es': {
                      'log_in_tittle' : 'Ingreso',
                      'email' : 'Correo electrónico',
                      'password' : 'Contraseña' ,
                      'log_in' : 'Ingresar',
                      'email_form' : 'Debe ser una direccion de correo válida',
                      'repeat_pass' : 'Repite tu contraseña',
                      'email_or_pass_wrong' : 'Correo o contraseña incorrectos.'
                    }
                  }
              }
            },
          recommender : {
            type : String
          }
      },

      submit : function(e){
        this.$.spinner.active = true;
        this.$.spinner.hidden = false;
        this.$.registerForm.submit();
      },
      responseHandler : function(e){
        var response = e.detail.__data__.response;
        this.$.spinner.active = false;
        this.$.spinner.hidden = true;

        if(response.success==false){
          this.$.toast.text = this.localize('email_or_pass_wrong');
          this.$.toast.open();
        }else if(response.user){
          this.fire('route-change',{ route : 'acco'});
        }
      },
      handleThirdPartyLogin:function(e){
        this.fire('route-change',{ route : 'acco'});
      }

    });
  </script>
</dom-module>
