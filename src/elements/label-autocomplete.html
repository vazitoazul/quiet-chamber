<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-autocomplete/paper-autocomplete-suggestions.html">
<link rel="import" href="../../bower_components/iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../elements/label-element.html">
<link rel="import" href="../elements/label-chip.html">
<link rel="import" href="../redux/global-store.html">
<dom-module id="label-autocomplete">
   <style include="shared-styles">
    div.wraper{
      position:relative;
      max-width: 300px;
    }
    div.labels{
      max-width: 300px;
    }
    paper-autocomplete-suggestions{
      --suggestions-wrapper:{
        color:var(--primary-text-color);
      }
    }
   </style>
   <template>
     <label-element labels="{{labelArray}}"></label-element>
     <div class="wraper">
       <paper-input label="Relacionado con" id="autocompleteInput"></paper-input>
       <paper-autocomplete-suggestions for="autocompleteInput" source="[[labelArray]]" on-autocomplete-selected="labelSelected"></paper-autocomplete-suggestions>
     </div>
     <div class="labels">
       <template is="dom-repeat" items="[[selectedLabels]]">
         <label-chip item="[[item]]" on-closed="spliceLabel" closeable></label-chip>
       </template>
     </div>
   </template>
   <script>
    Polymer({
      is: 'label-autocomplete',

      behaviors : [
        Polymer.AppLocalizeBehavior,
        GlobalStoreBehavior
      ],

      properties:{
        language:{
          type:String,
          statePath:'language'
        },
        resources:{
          value:function(){
            return {
              'en':{
              },
              'es':{
              }
            }
          }
        },
        selectedLabels : {
          type : Array,
          value : function(){
            return [];
          }
        },
        labelsArray :{
          type : Object
        }
      },
      labelSelected: function(e){
        this.selectedLabels.forEach((item)=>{
          if(item.value===e.detail.option.value){
            return ;
          }
        });
        this.push('selectedLabels',e.detail.option);
        this.$.autocompleteInput.value='';
      },
      spliceLabel:function(e){
        this.selectedLabels.forEach((item,index)=>{
          if(item.value===e.detail.value){
            this.splice('selectedLabels',index,1);
          }
        });
      },
      showMessage:function(message,duration){
        this.$.toast.text = message;
        this.$.toast.duration=duration || 3000;
        this.$.toast.open();
      },
      focusInput : function(){
        this.$.autocompleteInput.focus();
      }
    })
   </script>
</dom-module>
