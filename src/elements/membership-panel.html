<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../redux/global-store.html">
<link rel="import" href="../redux/actions/payments-actions.html">
<link rel="import" href="../shared-styles.html">
<dom-module id="membership-panel">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        height: 90vh;
      }
      #dialog{
        max-height: 90vh;
        width: 50%;
      }
      span.value{
        font-size: 1.3rem;
      }
      div.loading-overlay{
        height: 100%;
        width: 100%;
        position: absolute;
        top: -15px;
        background-color: rgba(0,0,0,0.2);
      }
      iron-image.qr{
        height: 200px;
        width: 200px;
        @apply(--layout-self-center);
      }
      #dialog{
        background-color: #fff;
      }
    </style>
    <div class="vertical">
      <div class="horizontal">
        <div hidden$="[[user.isSuscribed]]">
          <paper-card  class="vertical subscription">
            <div class="card-content flex">
              <h4>No tienes una suscripción activa</h4>
              <span>Encuentra todos los beneficios de suscribirte <a href="#">Aquí</a></span>
            </div>
            <div class="card-actions horizontal center">
              <b>Inicia una subscripción ahora</b>
              <div class="flex"></div>
              <paper-button class="accent" on-tap="openDialog">Iniciar Subscripción</paper-button>
            </div>
          </paper-card>
        </div>
      </div>
    </div>
    <paper-dialog id="dialog" >
      <h2>Iniciar una subscripción</h2>
      <div>
        <div class="vertical">
          <b>Lee con atención los pasos que debes seguir:</b>
          <ol>
            <li>A continuación te vamos a redirigir a la página donde puedes realizar el pago. </li>
            <li>Allí encontrarás la dirección de bitcoin a la cual debes realizar el depósito. Recuerda que Alfacoin (la red mediante la cual manejamos los pagos) cobra un cargo extra por la transferencia del dinero.</li>
            <li>Una vez recibida tu transacción, espera a que se confirme en la red de bitcoins. Puedes visitar la sección de <b>Membrecia</b> dentro de tu cuenta para mantenerte al tanto. </li>
            <li>Recuerda que debes depositar el valor exacto, de otro modo, tendrás problemas iniciando tu subscripción.</li>
            <li>Disfruta tu subscripción y gana dinero!</li>
          </ol>
        </div>
        <div class="horizontal layout">
          <div class="flex">
            <paper-checkbox checked="{{stepsUnderstand}}">Entiendo los pasos, continuar con el pago.</paper-checkbox>
          </div>
          <paper-button class="accent" disabled="{{!stepsUnderstand}}" on-click="continuePayment">Continuar al pago</paper-button>
        </div>
      </div>
    </paper-dialog>
    <paper-toast id="toast" ></paper-toast>

  </template>
  <script>
    Polymer({
      is: 'membership-panel',
      behaviors:[
        Polymer.AppLocalizeBehavior,
        GlobalStoreBehavior,
        PaymentsActionsBehavior
      ],
      properties:{
        state:{
          type:Object,
          statePath:'payouts',
          observer:'_payoutChange'
        },
        user:{
          type:Object,
          statePath:'user.info'
        },
        amount:{
          type:Object,
          observer:'_getAmounts',
          value:0
        },
        language:{
          type:String,
          statePath:'language'
        },
        subStep:{
          type:String,
          value:'0'
        },
        depositState:{
          type:String,
          value:0
        },
        resources:{
          value:function(){
            return {
              'es':{
                'date': '{ value , date , medium}'
              },
              'en':{
                'date': '{ value , date , medium}'
              }
            }
          }
        }
      },
      showMessage:function(text,duration){
        this.$.toast.text=text;
        this.$.toast.duration=duration||3000;
        this.$.toast.open();
      },
      showDecimal:function(decimal){
        if(!decimal)return '0.00';
        if(typeof decimal!=='number'){
          decimal = Number(decimal);
        }
        return decimal.toFixed(2);
      },
      attached:function(){
        this.$.dialog.fitInto=this;
        this.$.toast.fitInto=this;

      },
      requestAddress:function(){
        this.dispatch('requestWalletAdd',(err,resp)=>{
          if(err)console.log(err);
          this.openDialog();
        });
      },
      showAddress:function(){
        this.openDialog();
      },
      _getAmounts:function(newVal){
        if(!newVal){
          this.tCost=0;
          this.finalValue=0;
        };

        this.tCost=newVal*0.02
        if(this.tCost>=20){
          this.tCost=20;
        }
        this.finalValue=newVal-(-this.tCost);
      },
      openDialog:function(){
        this.$.dialog.open();
      },
      continuePayment:function(){
        window.location=window.location.origin+'/payment/requestOrder';
      }

    });
  </script>
</dom-module>
